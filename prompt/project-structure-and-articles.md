# 项目结构设计原则和文章定义

## 核心需求

根据文件类型和用途，将项目文件分类组织：

- **部署相关的** → 放入 `deploy/` 目录
- **文章内容相关的** → 放入 `book/` 或其他内容目录
- **垃圾文件** → 放入 `trash/` 目录，并在 `.gitignore` 中忽略，不被别人看到
- **设计文档和 prompt** → 放入 `prompt/` 目录

## 需要显示在博客上的文章的定义

**文章必须同时满足以下条件：**

1. **不在 `deploy/` 目录中** - 部署配置和脚本不应该是文章
2. **不在 `trash/` 目录中** - 垃圾文件不应该显示
3. **不在 `prompt/` 目录中** - 设计文档和 prompt 不是文章内容
4. **不在 `.gitignore` 中被忽略** - 被忽略的文件不应该部署

**满足以上条件的 `.md` 文件会被自动收集、生成并部署到博客上。**

## 设计原则

### 1. 部署相关文件 → `deploy/`

所有与 Hexo 配置、构建、部署相关的文件都应该放在 `deploy/` 目录下：

- Hexo 配置文件（`_config.yml`）
- 部署脚本（`scripts-tools/`）
- GitHub Actions 工作流（`.github/workflows/`）
- 主题和模板文件
- 构建生成的临时文件

**原因**：保持部署配置和文章内容的清晰分离，便于管理和维护。

### 2. 文章内容 → `book/` 等目录

所有文章内容按分类组织在根目录下的各个文件夹中：

- `book/` - 书籍相关文章
- 其他分类目录 - 根据内容主题自由创建（如 `前端/`、`后端/`、`学习/` 等）
- 支持多层嵌套目录结构

**原因**：文章是核心内容，应该清晰可见，便于管理和访问。

### 3. 垃圾文件 → `trash/` + `.gitignore`

不需要的文件放入 `trash/` 目录，并在 `.gitignore` 中忽略：

```gitignore
trash/
```

**原因**：保留文件但不提交到 Git，避免被别人看到，同时本地可以保留作为备份。

### 4. 设计文档 → `prompt/`

项目设计文档、需求记录、prompt 等放入 `prompt/` 目录：

- 项目结构设计原则
- 关键决策记录
- 供 AI 理解项目的 prompt

**原因**：设计文档不是文章内容，不应该显示在博客上，但需要版本控制。

## 项目结构示例

**⚠️ 重要：此项目结构示例必须与实际项目保持同步**

当项目结构发生变化时（新增或删除目录、文件），必须同步更新此示例，以便 AI 能够准确理解项目的当前状态。

```
/root/code/
├── deploy/              # 部署相关（Hexo 配置、脚本、工作流）
│   ├── .github/         # GitHub Actions 工作流
│   │   └── workflows/
│   │       └── deploy.yml
│   ├── _config.yml      # Hexo 配置
│   ├── source/          # Hexo 源文件目录
│   │   ├── _posts/      # 文章目录（符号链接）
│   │   └── about/       # 关于页面
│   └── ...
├── ml/                  # 文章内容（机器学习/课程笔记等）
│   └── cs189/
│       └── lecture1/
│           └── lecture1.md ✅ 会被部署
├── book/                # 文章内容（书籍相关）
│   └── heart/
│       └── the-road-to-financial-freedom/
│           └── the-road-to-financial-freedom.md  ✅ 会被部署
├── principle/           # 文章内容（原则和方法论）
│   └── principle.md     ✅ 会被部署
├── security/            # 文章内容（安全相关）
│   └── OIDC/
│       └── OIDC.md      ✅ 会被部署
├── source/              # 文章内容（不推荐与 Hexo 的 source 混淆，但目前会被自动收集）
│   └── learn/
│       └── learn.md     ✅ 会被部署
├── travel/              # 文章内容（旅游相关）
│   └── singapore/
│       └── singapore.md ✅ 会被部署
├── prompt/              # 设计文档和 prompt
│   └── project-structure-and-articles.md     ❌ 不会被部署
├── trash/               # 垃圾文件（在 .gitignore 中）
│   └── old-article.md   ❌ 不会被部署
└── .gitignore           # 忽略 trash/ 目录
```

## 自动收集机制

GitHub Actions 工作流会自动：

1. 扫描项目根目录下的所有 `.md` 文件
2. 排除以下目录：
   - `deploy/` - 部署相关
   - `trash/` - 垃圾文件
   - `prompt/` - 设计文档
   - `.git/` - Git 元数据
   - `node_modules/` - 依赖包
3. 为符合条件的文件创建符号链接到 `deploy/source/_posts/`
4. 根据文件路径自动设置 permalink
5. 生成静态文件并部署到 GitHub Pages

## 使用场景

这个 prompt 可以用于：

1. **新成员理解项目结构**：快速了解文件组织原则和文章定义
2. **AI 助手理解项目**：喂给大模型时，能快速理解设计意图和文章筛选规则
3. **维护项目一致性**：确保新文件放在正确的位置，符合文章定义的文件会被自动部署

## 本文档的核心目的

**帮助 AI 快速理解项目结构，并高效地完成博客推送任务。**

### AI 工作流程

当用户说"帮我推送到博客"时，AI 应该：

1. **检查文件修改**
   ```bash
   git status
   ```

2. **确认 `updated` 字段已更新**
   - 检查修改的文章是否更新了 `updated` 字段为当前时间
   - **必须使用准确的当前日期和时间**（中国标准时间 UTC+8）
   - 如果不确定当前时间，使用 `web_search` 工具联网查询
   - 如果没有更新，提醒用户或帮助更新

3. **提交并推送**
   ```bash
   git add <修改的文件>
   git commit -m "update: 简短描述修改内容"
   git push origin main
   ```

4. **确认部署**
   - 推送到 `main` 分支后，GitHub Actions 会自动触发部署
   - 部署完成后，博客会自动更新

### 关键原则

- **项目结构示例必须实时更新**：当项目结构变化时，同步更新本文档中的示例
- **文章必须更新 `updated` 字段**：每次修改文章后推送前，必须更新时间戳
- **自动化部署**：只要推送到 `main` 分支，所有符合定义的文章都会自动部署
- **AI 可以修复文章内容**：用户可能会写一些偏 vibe（意会的、不够精确的）线索点放到 .md 文件里，AI 应该理解用户的意图，进行恰当的修复和完善，包括：
  - 修正拼写错误和格式问题
  - 补全不完整的句子
  - 优化表达使其更清晰
  - 整理结构使其更有条理
  - 保持用户的原意和风格

## 文章时间戳规则

每篇文章的 front matter 必须包含时间戳字段：

- **`date`**：文章创建时间，只在首次创建时设置，之后不再修改
- **`updated`**：文章最后修改时间，**每次修改文章内容时必须更新**

### ⚠️ 重要：修改文章时必须更新 `updated` 字段

**每次修改文章内容后，在推送到博客之前，必须手动更新 `updated` 字段为当前时间。**

### 如何获取准确的当前时间

**AI 必须使用准确的当前日期和时间，避免使用错误的日期。**

1. **首先确认当前日期**
   - 系统信息中会显示当前日期（如 `Current Date: Wednesday Jan 21, 2026`）
   - 如果不确定，使用 `web_search` 工具联网查询当前时间
   - 时区：使用**中国标准时间（UTC+8）**

2. **更新时间格式**
   - 格式：`YYYY-MM-DD HH:mm:ss`
   - 示例：`2026-01-21 11:20:00`

3. **常见错误示例**
   - ❌ 使用昨天的日期（如在 1月21日 使用 2026-01-20）
   - ❌ 不联网确认就假设日期
   - ❌ 使用错误的时区

更新方式：
```yaml
updated: 2026-01-21 11:20:00  # 改为当前的日期和时间（中国标准时间）
```

示例：
```yaml
---
title: 文章标题
date: 2026-01-19 17:49:09
updated: 2026-01-20 19:30:00  # 每次修改都要更新这个时间
tags:
  - 标签1
  - 标签2
---
```

**排序规则**：
- 博客首页和归档页面按 `updated` 时间倒序排列
- 最近修改的文章会显示在最前面
- 页面上同时显示创建时间和修改时间

## UI 设计原则（QOJ 风格）

博客采用极简风格，参考 [QOJ.ac](https://qoj.ac/) 的设计：

### 导航栏
- **只有两个按钮**：
  - **博客** → `/archives/`（所有文章按 `updated` 时间倒序排列，类似 QOJ 的 Contests）
  - **分类** → `/categories/`（文件夹树结构，类似 QOJ 的 Category）
- 移除其他导航项（主页、标签、关于等）

### 页面设计
- **首页**：简洁列表，无花哨 banner
- **分类页**：文件夹树结构，点击进入子文件夹或文章列表
- **整体风格**：极简、干净、功能优先

## Categories 自动生成机制

### 核心原则
- **Categories 的文件夹结构 = 博客内容目录结构**
- 自动从文件路径生成 categories，无需手动维护

### 生成规则
1. **路径映射**：文件路径直接映射为 categories 层级
   - 例如：`ml/cs189/lecture1/lecture1.md` → `categories: [ml, cs189, lecture1]`
   - 例如：`book/heart/the-road-to-financial-freedom/xxx.md` → `categories: [book, heart, the-road-to-financial-freedom]`

2. **排除规则**：以下目录不参与 categories 生成（因为它们不会被 symlink 到 `_posts`）：
   - `deploy/` - 部署相关
   - `trash/` - 垃圾文件
   - `prompt/` - 设计文档
   - `.github/` - Git 工作流
   - `.git/` - Git 元数据
   - `node_modules/` - 依赖包

3. **图片处理**：图片文件（`.png`、`.jpg` 等）不单独展示，只作为文章资源使用

### 实现方式
- **脚本**：`deploy/scripts/set-categories.js` 自动从文件路径生成 categories
- **手动补充**：如果脚本未生效，需要在 front matter 中手动添加 categories
- **Categories 页面**：需要创建 `deploy/source/categories/index.md`（类型为 `categories`）

### Categories 页面结构
- **非叶子节点**：显示子文件夹列表（类似 QOJ 的 Category 页面）
- **叶子节点**：显示该分类下的文章列表
- **约束**：某个目录的子节点要么全是文件夹，要么全是文章，不混搭

### 按钮跳转示例
- 在文章中可以添加按钮跳转到特定分类，例如：
  - `[📚 查看我的 CS189 笔记](/categories/ml/cs189/)`

## 关键决策记录

- **scripts-tools 的位置**：从根目录移动到 `deploy/scripts-tools/`，因为它们是部署相关的工具
- **trash 目录的处理**：在 `.gitignore` 中忽略，保留本地但不提交，不部署
- **prompt 目录的处理**：设计文档不应该是文章，需要排除
- **文章目录的灵活性**：支持多层嵌套，所有符合定义的文章都会被自动收集和展示
- **文章 URL 规则**：基于文件路径，如 `book/heart/the-road-to-financial-freedom/`
- **时间戳管理**：每次修改文章都要更新 `updated` 字段，按修改时间排序显示
- **UI 风格**：采用 QOJ 风格的极简设计，导航栏只有"博客"和"分类"两个按钮
- **Categories 自动生成**：从文件路径自动生成 categories，保持目录结构与 categories 结构一致


